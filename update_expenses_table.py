#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
Ø³ÙƒØ±ÙŠØ¨Øª ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª
Ø¥Ø¶Ø§ÙØ© Ø£Ø¹Ù…Ø¯Ø© car_id Ùˆ employee_id
"""

import sqlite3
import os

def update_expenses_table():
    """ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©"""
    
    # Ù…Ø³Ø§Ø± Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    db_path = 'management_system.db'
    
    if not os.path.exists(db_path):
        print("âŒ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©!")
        return False
    
    try:
        conn = sqlite3.connect(db_path)
        cursor = conn.cursor()
        
        print("ğŸ”§ Ø¨Ø¯Ø¡ ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª...")
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©
        cursor.execute("PRAGMA table_info(expenses)")
        columns = [column[1] for column in cursor.fetchall()]
        
        print(f"ğŸ“‹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: {columns}")
        
        # Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ car_id Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if 'car_id' not in columns:
            print("â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ car_id...")
            cursor.execute('ALTER TABLE expenses ADD COLUMN car_id INTEGER')
            print("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ car_id")
        else:
            print("âœ… Ø¹Ù…ÙˆØ¯ car_id Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„")
        
        # Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ employee_id Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
        if 'employee_id' not in columns:
            print("â• Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ employee_id...")
            cursor.execute('ALTER TABLE expenses ADD COLUMN employee_id INTEGER')
            print("âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¹Ù…ÙˆØ¯ employee_id")
        else:
            print("âœ… Ø¹Ù…ÙˆØ¯ employee_id Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„")
        
        # Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        conn.commit()
        print("ğŸ’¾ ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª")
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
        cursor.execute("PRAGMA table_info(expenses)")
        updated_columns = [column[1] for column in cursor.fetchall()]
        print(f"ğŸ“‹ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«: {updated_columns}")
        
        conn.close()
        print("ğŸ‰ ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­!")
        return True
        
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„: {e}")
        return False

if __name__ == '__main__':
    print("=" * 50)
    print("ğŸ”§ Ø³ÙƒØ±ÙŠØ¨Øª ØªØ­Ø¯ÙŠØ« Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª")
    print("=" * 50)
    
    success = update_expenses_table()
    
    print("=" * 50)
    if success:
        print("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­!")
        print("ğŸš€ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ´ØºÙŠÙ„ Ø§Ù„Ù†Ø¸Ø§Ù… Ø¨Ø¯ÙˆÙ† Ù…Ø´Ø§ÙƒÙ„")
    else:
        print("âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«!")
        print("ğŸ”§ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø£Ø¹Ù„Ø§Ù‡")
    print("=" * 50)